[doc-dsl-ext]:              ../dsl/intro.md
[doc-record-mode]:          ../poc/ci-mode-recording.md
[doc-test-mode]:            ../poc/ci-mode-testing.md

[anchor-allowed-hosts]:     #要録画のリクエスト数を制限する

#   FAST ノードに使用される環境変数の一覧

FAST ノードを設定するために多くのパラメータが使用されます。これらのパラメータの値は、対応する環境変数を介して変更することができます。

環境変数の値を設定し、それらの変数を FAST ノードに渡すことができます
* `-e` 引数を通じて
    
    ```
    docker run --name <コンテナ名> \
    -e <環境変数 1>=<値> \
    ... 
    -e <環境変数 N>=<値> \
    -p <ターゲットポート>:8080 wallarm/fast
    ```
    
* または、環境変数を含むファイルへのパスを指定する `--env-file` 引数を通じて

    ```
    docker run --name <コンテナ名> \
    --env-file=<環境変数を含むファイル> \
    -p <ターゲットポート>:8080 wallarm/fast
    ```
    
    このファイルは、1行に1つの環境変数を含む環境変数の一覧を含む必要があります:

    ```
    # 環境変数のサンプルファイル

    WALLARM_API_TOKEN=token_Qwe12345            # これはサンプルの値です。代わりに実際のトークンの値を使用してください
    ALLOWED_HOSTS=google-gruyere.appspot.com    # このドメインに向けた着信リクエストはテストレコードに書き込まれます
    ```

以下の表に、すべての設定可能なパラメータがリストアップされています:

| パラメータ             | 値     | 必須? |
|--------------------	| --------	| -----------	|
| `WALLARM_API_TOKEN`  	| Wallarm クラウドからのトークン | はい |
| `WALLARM_API_HOST`   	| Wallarm API サーバーのアドレス。<br>許可される値: <br>`us1.api.wallarm.com` は Wallarm US クラウド内のサーバー用、<br>`api.wallarm.com` は Wallarm EU クラウド内のサーバー用。 | はい |
| `ALLOWED_HOSTS`       | ターゲットアプリケーションのホストの一覧。これらのホストに対象とされた着信リクエストはテストレコードに書き込まれます。<br>すべての着信リクエストがデフォルトで記録されます。<br>詳細は[ここ][anchor-allowed-hosts]を参照してください。 | いいえ |
| `WALLARM_API_USE_SSL` | Wallarm API サーバーのいずれかに接続する際にSSLを使用するかどうかを定義します。<br>許可される値: `true` および `false`。<br>デフォルト値: `true`。 | いいえ |
| `WORKERS`             | ベースラインリクエストを処理し、セキュリティテストを行うスレッドの数。<br>デフォルト値: `10`. | いいえ |
| `GIT_EXTENSIONS`      | [カスタムFAST DSL拡張][doc-dsl-ext]を含むGitリポジトリへのリンク（このリポジトリはFASTノードコンテナからアクセス可能であるべきです） | いいえ |
| `CI_MODE`             | CI/CDに統合する際のFASTノードの動作モード。 <br>許可される値は次のとおりです: <br>`recording` は[記録モード][doc-record-mode]用、<br>`testing` は[テストモード][doc-test-mode]用です。 | いいえ |
| `BACKEND_HTTPS_PORTS` | アプリケーションに非デフォルトのポートが設定されている場合、ターゲットアプリケーションが使用するHTTPSポート番号。<br>このパラメータの値には複数のポートがリストアップされることがあります。例: <br>`BACKEND_HTTPS_PORTS='443;3000;8091'`<br>デフォルト値: `443` | いいえ |
| `WALLARM_API_CA_VERIFY` | Wallarm APIサーバーのCA証明書が有効であるべきかを定義します。<br>許可される値:`true` と`false`。<br>デフォルト値:`false`。 | いいえ |
| `CA_CERT`             | FASTノードで使用するCA証明書へのパス。<br>デフォルト値: `/etc/nginx/ssl/nginx.crt`. | いいえ |
| `CA_KEY`              | FASTノードで使用するCAプライベートキーへのパス。 <br>デフォルト値: `/etc/nginx/ssl/nginx.key`. | いいえ |


## 要記録のリクエスト数を制限する

デフォルトでは、FAST ノードはすべての着信リクエストをベースラインとして扱います。したがって、ノードはそれらを記録し、その基盤となるセキュリティテストを作成および実行します。しかし、ベースラインのリクエストとして認識すべきでない余計なリクエストがFASTノードを通過してターゲットアプリケーションに届く可能性があります。

FAST ノードによる要録画のリクエスト数を、アプリケーションを対象としないすべてのリクエストをフィルタリングして制限することができます（FAST ノードはフィルタリングされたリクエストをプロキシしますが、それらを記録しません）。この制限は、FAST ノードとターゲットアプリケーションに適用される負荷を軽減しながら、テストプロセスを迅速化します。この制限を適用するには、テスト中にリクエスト元がどのホストと対話するかを知る必要があります。

`ALLOWED_HOSTS` 環境変数を設定することで、すべてのベースラインでないリクエストをフィルタリングできます。

--8<--  "../include-ja/fast/operations/env-vars-allowed-hosts.md"

FAST ノードはこの環境変数を以下のように使用します:
* 送信リクエストの `Host` ヘッダの値が `ALLOWED_HOSTS` 変数で指定した値と一致する場合、FAST ノードはそのリクエストがベースラインリクエストであると見なします。そのリクエストは記録され、プロキシ化されます。
* その他のすべてのリクエストはFASTノードを通じてプロキシ化されますが、記録されません。

!!! info "ALLOWED_HOSTS 環境変数の使用例"
    変数が `ALLOWED_HOSTS=google-gruyere.appspot.com` として定義されている場合、`google-gruyere.appspot.com` ドメインに対象とされたリクエストはベースラインと見なされます。