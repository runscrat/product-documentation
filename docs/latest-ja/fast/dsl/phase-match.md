[link-points]:          points/intro.md
[link-ruby-regexp]:     http://ruby-doc.org/core-2.6.1/doc/regexp_rdoc.html
[link-ext-logic]:       logic.md

# マッチ段階

!!! info "段階の範囲"  
    この段階は、拡張子を変更した際に使用し、その動作には任意です（`match`セクションはYAMLファイルに存在してもしなくても構いません）。

    この段階は、非修正拡張子のYAMLファイルには存在してはなりません。

    拡張子の種類についての詳細は[ここ][link-ext-logic]で読むことができます。

!!! info "リクエスト要素記述構文"
     FAST拡張子を作成する際には、アプリケーションに送信されるHTTPリクエストの構造と、アプリケーションから受信したHTTPレスポンスの構造を理解する必要があります。それにより、ポイントを使用して作業する必要のあるリクエスト要素を正確に記述することができます。

    詳細情報を見るには、この[リンク][link-points]に進んでください。

この段階では、指定された基準に基づいたリクエストが一致するかどうかをチェックします。

拡張的YAMLファイル内の `match` セクションには `<key: value>` のペアの配列が含まれています。各ペアはリクエストの特定の要素（キー）とその要素のデータ（値）を記述します。キーと値には [Ruby正規表現形式][link-ruby-regexp]の正規表現を含めることができます。

マッチ段階では、指定された `<key: value>` のペアすべてについて、基線リクエスト内でマッチを探します。
* リクエストは、必要な要素（例えば、URLのパス値、GETパラメータ、またはHTTPヘッダー）が必要なデータを持つことについてチェックされます。
    
    ??? info "例1"
        `'GET_a_value': '^\d+$'` — `a` という名前のGETパラメータを含む値は、リクエストに含まれている必要があります。
    
    ??? info "例2"
        `'GET_b*_value': '.*'` — `b` から始まる名前のGETパラメータ（値が何でも、空の値も含む）がリクエストに含まれている必要があります。

* キーの値が `null` に設定されている場合、リクエストから対応する要素の存在がチェックされます。

    ??? info "例"
        `'GET_a': null` — `a` という名前のGETパラメータがリクエストには存在していないはずです。

基線リクエストがマッチ段階を通過するためには、リクエストが `match` セクションの `<key: value>` のペアすべてを満たしている必要があります。もし、`match` セクションで記述された `<key: value>` のペアのどれも基線リクエストにマッチしない場合、そのリクエストは破棄されます。

??? info "例"
    下記の `match` セクションには、`<key: values>` のペアのリストが含まれています。基線リクエストがマッチ段階を通過するためには、これらのペアすべてを満たす必要があります。

    ```
    match:
    - 'HEADER_HOST_value': 'example.com'
    - 'GET_password_value': '^\d+$'
    - 'HEADER_CONTENT-TYPE_value': null
    ```

    1. 基線リクエストは、`Header` という名前のHTTPヘッダを含むべきで、その値は `example.com` を含むサブストリングであるべきです。
    2. `password` のGETパラメータの値は数字のみであるべきです。
    3. `Content-Type` ヘッダは存在してはなりません。