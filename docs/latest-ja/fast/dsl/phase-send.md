[link-ext-logic]:       logic.md

# 送信フェーズ

!!! info "フェーズの範囲"
    これは、非修正拡張が動作するための必須のフェーズであり（YAMLファイルは `send` セクションを含めなければなりません）。
    
    このフェーズは、修正拡張では存在せず、送信フェーズと組み合わせると他のフェーズが使用できなくなるためです（ただし、検出フェーズと暗黙的な収集フェーズは除く）。
    
    拡張のタイプについて詳しくは、[こちら][link-ext-logic] をご覧ください。

このフェーズでは、定義済みのテストリクエストを送信して、ターゲットアプリケーションが脆弱性を持っているかどうかをテストします。テストリクエストが送信されるべきホストは、元のベースラインリクエストの `Host` ヘッダー値によって決定されます。

`send` セクションは次の構造を持っています：

```
send:
  - method: <HTTP メソッド>
    url: <URI>
    headers:
    - ヘッダー 1: 値
    ...
    - ヘッダー N: 値
    body: <リクエストボディ>
  ...
  - method: <HTTP メソッド>
    ...
```

拡張のYAMLファイル内の `send` セクションには、1つ以上のパラメーターセットが含まれています。各パラメーターは `<キー：値>` のペアで指定されます。指定されたパラメーターセットは、テストリクエストとして送信される1つのHTTPリクエストを表します。以下のパラメーターがセットの一部となります：

* `method`：リクエストで使用されるHTTPメソッド。

    これは必須のパラメーターで、任意のパラメーターセットに存在する必要があります。
    
    ??? info "許可されたパラメーター値のリスト"

        * `GET`
        * `POST`
        * `PUT`
        * `HEAD`
        * `OPTIONS`
        * `PATCH`
        * `COPY`
        * `DELETE`
        * `LOCK`
        * `UNLOCK`
        * `MOVE`
        * `TRACE`

    ??? info "例"
        `method: 'POST'`

* `url`：URL文字列。リクエストはこのURIに対して行われます。

    これは必須のパラメーターで、任意のパラメーターセットに存在する必要があります。
    
    ??? info "例"
        `url: '/en/login.php'`

* `headers`：1つ以上のHTTPヘッダーを含む配列。フォーマットは `ヘッダー名：ヘッダー値` です。

    構築したHTTPリクエストがヘッダーを使用しない場合、このパラメーターは省略することができます。
    
    FASTは、結果のHTTPリクエストが正確になるように必要なヘッダーを自動的に追加します（たとえそれらが `headers` 配列に存在しなくても）。たとえば、 `Host` および `Content-Length` です。
    
    ??? info "例"
        ```
        headers:
        - 'Accept-Language': 'en-US,en;q=0.9'
        - 'Content-Type': 'application/xml'
        ```
      
    !!! info "`Host` ヘッダーの操作"
        必要に応じて、ベースラインリクエストから抽出したものとは異なる `Host` ヘッダーをテストリクエストに追加することができます。
        
        たとえば、Sendセクションのテストリクエストに `Host: demo.com` ヘッダーを追加することが可能です。
    
        適応拡張機能が動作しており、FASTノードが `Host: example.com` ヘッダーを持つベースラインリクエストを受信した場合、ヘッダーが `Host: demo.com` のテストリクエストが `example.com` ホストに送信されます。結果のリクエストは以下のようになります：

        ```
        curl -k -g -X POST -L -H "Host: demo.com" -H "Content-Type: application/json" "http://example.com/app" --data "{"field":"value"}"
        ```
    
* `body`：リクエストのボディを含む文字列。必要なリクエストボディを任意に指定することができます。ただし、結果の文字列内の特殊文字はエスケープする必要があります。

  これは必須のパラメーターで、任意のパラメーターセットに存在する必要があります。
  
   ??? info "例"
       `body: 'field1=value1&field2=value2`

`send` セクションが `N` 個のパラメーターセットで構成され、その各々が `N` 個のHTTPリクエストを説明している場合、単一の入力ベースラインリクエストについて、FASTノードはベースラインリクエストの `Host` ヘッダーで指定されたホスト上のターゲットアプリケーションに `N` 個のテストリクエストを送信します。