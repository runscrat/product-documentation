[allowlist-scanner-addresses]: ../user-guides/ip-lists/allowlist.md

# アクティブな脅威の検証機能の設定に関するベストプラクティス <a href="../../about-wallarm/subscription-plans/#subscription-plans"><img src="../../images/api-security-tag.svg" style="border: none;"></a>

Wallarmが[脆弱性を検出](../about-wallarm/detecting-vulnerabilities.md)するために使用する一つの方法は、**アクティブな脅威の検証**です。これにより、侵入テスターから攻撃者に向きを変えて、その活動から可能なセキュリティ問題を発見することができます。このモジュールは、トラフィックから実際の攻撃データを使用してアプリケーションのエンドポイントを探して可能な脆弱性を見つけます。このモジュールが安全に動作するためには、本記事からその設定のベストプラクティスを学んでください。

デフォルトでは、**アクティブな脅威の検証**は無効化されています。モジュールを有効化するためには、[攻撃再チェッカーの制御方法を理解](#攻撃再チェッカーの制御方法を理解する)すべきです。

!!! warning "IPによるグループ化された攻撃に対するアクティブな脅威の検証"
    攻撃が起源のIPによって[グループ化](../about-wallarm/protecting-against-attacks.md#attack)されている場合、この攻撃のアクティブな検証は利用できません。

## アクティブな脅威の検証機能の動作方法

--8<-- "../include/how-attack-rechecker-works.md"

## 攻撃再チェッカーの活動からの潜在的なリスク

* 正当なリクエストがWallarmによって攻撃として検出されると、そのリクエストは**攻撃再チェッカー**によって再生されます。非冪等性のリクエスト（例えば、アプリケーション内で新しいオブジェクトを作成する認証済みのリクエスト）の場合、**攻撃再チェッカー**のリクエストは、ユーザーのアカウントに多くの不要な新しいオブジェクトを生成したり、他の予期しない操作を行ったりする可能性があります。

    記述した状況のリスクを最小限に抑えるために、**Attack rechecker**は、再生されたリクエストから以下のHTTPヘッダーを自動的に削除します：

    * `Cookie`
    * `Authorization: Basic`
    * `Viewstate`
* アプリケーションが非標準的な認証方法を使用している場合やリクエストの認証を必要としない場合、**Attack rechecker**はトラフィックから任意のリクエストを再生し、システムに損害を与える可能性があります。例えば、100以上のマネートランザクションや注文が繰り返される。このような状況のリスクを最小限に抑えるために、[攻撃再生のためのテスト環境やステージング環境を使用する](#optional-configure-attack-rechecker-request-rewriting-rules-run-tests-against-a-copy-of-the-application)ことや、[非標準的なリクエスト認証パラメーターをマスキングする](#適切なデータマスキングルールを設定する)ことが推奨されています。

## 攻撃再チェッカー設定のベストプラクティス

### 適切なデータマスキングルールを設定する

あなたのアプリケーションが非標準的な認証方法を使用している場合（例えば、リクエスト文字列トークンやカスタムHTTPリクエストヘッダーやPOSTボディのJSON属性など）、適切な[データマスキングルール](../user-guides/rules/sensitive-data-rule.md)を設定して、情報をWallarmクラウドに送信するフィルターノードを制止すべきです。この場合、再生された**攻撃再チェッカー**のリクエストは、アプリケーションによって認証されず、システムに何らかの害を及ぼすことはありません。

### 攻撃再チェッカーの制御方法を理解する

**攻撃再チェッカー**モジュールのグローバル有効／無効スイッチは、Wallarm Console → [**脆弱性**](../user-guides/vulnerabilities.md)にあります。デフォルトではこのモジュールは無効化されています。

### 検出されたセキュリティインシデントについて、適切な通知とエスカレーションのルールを設定する

WallarmはSlack、Telegram、PagerDuty、Opsgenieなどの第三者メッセージングとインシデント管理サービスとの[統合](../user-guides/settings/integrations/integrations-intro.md)を提供しています。Wallarm Cloudインスタンスを統合を使用して、発見したセキュリティインシデントについて情報セキュリティチームに通知を送るように設定することを強く推奨します。

### フィルタリングノードからWallarm Cloudへの潜在的な機密情報漏洩の対応方法を理解する

フィルタリングノードが誤検出したリクエストを含む機密情報（認証トークンやユーザー名／パスワードなど）をWallarm Cloudに送信したことが分かった場合は、[Wallarmのテクニカルサポート](mailto:support@wallarm.com)にリクエストをWallarm Cloudのストレージから削除するように依頼することができます。また、適切な[データマスキングルール](../user-guides/rules/sensitive-data-rule.md)を設定することもできます。既に保存されているデータを変更することはできません。

### オプション：特定のアプリケーション、ドメイン、URLに対する攻撃再チェッカーテストを有効化／無効化する

いくつかのアプリケーションのエンドポイントが冪等性を持たず、リクエスト認証メカニズムを使用していない場合（例えば、新規顧客アカウントの自己登録など）**攻撃再チェッカー**の機能を特定のエンドポイントに対して無効化することが推奨されます。Wallarmは、顧客がどの特定の顧客のアプリケーション、ドメイン、またはURLが**攻撃再チェッカー**スキャナーを有効化または無効化すべきかを制御できるようにしています。これは[**アクティブ脅威検証のモードを設定する**ルール](../user-guides/rules/change-request-for-active-verification.md#rewriting-the-request-before-attack-replaying)を使用することで実現可能です。

### オプション：攻撃再チェッカーのリクエスト書き換えルールを設定する（アプリケーションのコピーに対してテストを実行する）

アプリケーションのコピーに対してチェックを実行し、本番アプリケーションのスキャンを完全に避けたい場合は、再生された攻撃リクエストの特定の要素を修正するように**攻撃再チェッカー**に指示する[ルール](../user-guides/rules/change-request-for-active-verification.md)を作成することが可能です。